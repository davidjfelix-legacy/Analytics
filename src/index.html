<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Analytics -- alpha</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/1.1.0/css/metricsgraphics.min.css">
    <style type="text/css">
      html, body {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #map-canvas {
        height: 400px;
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
    </style>
    <script type="text/javascript">
    // Any data that we expect to come from a server goes here

var coords = [
  [39.110912, -84.515619],  // the brandery
  [39.110431, -84.517092],  // the anchor otr
  [39.110431, -84.517092],  // the anchor otr
  [39.11104, -84.51536],  // kaze
  [39.11104, -84.51536],  // kaze
  [39.11104, -84.51536],  // kaze
  [39.11104, -84.51536],  // kaze
  [39.11104, -84.51536],  // kaze
];
    </script>
    <script type="text/javascript">
// async load code goes here

function asyncLoadGoogleMaps() {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src = 'https://maps.googleapis.com/maps/api/js?' +
    'key=AIzaSyCcRYxLFqKNT__Vc2Ou6eJYTchP86NZmks&' +
    'libraries=visualization&' +
    'callback=initialize';
  document.body.appendChild(script);
}

window.onload = asyncLoadGoogleMaps;

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/json2/20140204/json2.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/metrics-graphics/1.1.0/js/metricsgraphics.min.js"></script>
    <script type="text/javascript">
// "app code" goes here

var AuHeatmapPoint = Backbone.Model.extend({
  defaults: {
    lat: 0.0,
    lng: 0.0
  },

  getLatLngPoint: function() {
    return new google.maps.LatLng(this.get('lat'), this.get('lng'));
  }
});

var AuHeatmapPointArray = Backbone.Collection.extend({
  model: AuHeatmapPoint,

  getLatLngPointArray: function() {
    return this.each(auHeatmapPoint.getLatLngPoint);
  },

  getLatLngPointMVCArray: function() {
    return new google.maps.MVCArray(this.getLatLngPointArray);
  }
});

var AuHeatmapView = Backbone.View.extend({
  initialize: function(canvas_id, center, zoom) {
    var mapOptions = {
      zoom: zoom,
      center: new google.maps.LatLng(center[0], center[1]),
      mapTypeId: google.maps.MapTypeId.MAP
    };
    this.map = new google.maps.Map(document.getElementById(canvas_id), mapOptions);
    this.heatmap = new google.maps.visualization.HeatmapLayer();
    this.heatmap.setMap(this.map);
  }
});

function rawCoordsToLatLng(coords) {
  var latLngs = [];
  for (idx in coords) {
    var latLng = new google.maps.LatLng(coords[idx][0], coords[idx][1]);
    latLngs.push(latLng);
  }
  return latLngs;
}

function initialize() {
  var hm = new AuHeatmapView('map-canvas', [39.103053, -84.508708], 14);
  hm.heatmap.setData(new google.maps.MVCArray(rawCoordsToLatLng(coords)));
}

    </script>
  </body>
</html>
